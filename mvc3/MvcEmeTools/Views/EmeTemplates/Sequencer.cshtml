@model Dominio.Entidades.Escripte
@{
    ViewBag.Title = "Sequencer";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section js{
    <script src="@Url.Content("~/Scripts/google_prettifier/prettify.js")" type="text/javascript"> </script>
    <script src="@Url.Content("~/Scripts/jquery.textchange.min.js")" type="text/javascript"> </script>

    <script src="@Url.Content("~/Scripts/jsed/jsed.js")" type="text/javascript"> </script>
    <script src="@Url.Content("~/Scripts/EmeTools/emetools.js")" type="text/javascript"> </script>

    <script type="text/javascript">
        $().ready(function () {
            var executarRobo = function () {
                var texto = $("#preEscripteCompleto").html();
                return new RoboXixi(texto, '\n');
            };

            var selecionarEtapa = function (elJquery) {
                // limpa os itens selecionados
                $("#listaXixizeros li").attr("class", "naoSelecionado");

                // seleciona o item atual
                elJquery.attr("class", "selecionado");

                // pega o indice
                var indiceSelecionado = parseInt(elJquery.html().replace(/^([-\d]+).*/, "$1")) - 1;

                // recupera resultado do indice
                if (indiceSelecionado >= 0) {
                    $("#preResposta").html(roboXixi.Xixizeros[indiceSelecionado].DadoTransformado);
                    $("#preXixizero").html(roboXixi.Xixizeros[indiceSelecionado].Escripte);
                } else {
                    $("#preResposta").html(roboXixi.DadosIniciais);
                }

                prettyPrint();
            };

            var timeout;
            $('#preXixizero').bind('textchange', function () {
                clearTimeout(timeout);
                timeout = setTimeout(function () {
                    prettyPrint();
                }, 3000);
            });

            // executa toda transformação
            var roboXixi = executarRobo();
            roboXixi.Transformar();

            // cria a lista dos passos
            for (var i = 1; i <= roboXixi.Xixizeros.length; i++) {
                var xixizero = roboXixi.Xixizeros[i - 1];
                $("#listaXixizeros").append("<li>" + xixizero.Indice + " - " + xixizero.PrimeiroComentario() + "</li>");
            }

            // Executa toda transformação
            $("#preResposta").html(roboXixi.ResultadoFinal);

            // coloca evento para mudar a visualização dos resultados
            $("#listaXixizeros li").click(function () {
                selecionarEtapa($(this));
            });

            // CTRL + CIMA
            $.ctrl(38, function () {
                var anterior = $(".selecionado").prev();
                if (anterior.length === 0)
                    return false;
                selecionarEtapa(anterior);
            });
            // CTRL + BAIXO
            $.ctrl(40, function () {
                var proximo = $(".selecionado").next();
                if (proximo.length === 0)
                    return false;
                selecionarEtapa(proximo);
            });
        });

    </script>
}
<style>
    #container
    {
        width: 900px;
    }
    
    #divListaXixizeros
    {
        border-color: #eee;
        border-style: solid;
        float: left;
        width: 100%;
    }
    
    #divEscripte
    {
        border-color: #eee;
        border-style: solid;
        float: left;
        width: 100%;
    }
    
    #divPreEscripteCompleto
    {
        border-color: #eee;
        border-style: solid;
        float: left;
        width: 100%;
    }
    
    #preXixizero
    {
        font-size: 14pt;
        background-color: #fcfcfc;
        border-color: #efe;
        border-style: solid;
        height: 100%;
        width: 100%;
    }
    
    #listaXixizeros li
    {
        border-color: #eee;
        border-style: solid;
        border-width: 1px;
        padding: 2px;
        width: 90%;
        font-size: 10pt;
        cursor: pointer;
    }
    
    #divResultadoParcial
    {
        border-color: #eee;
        border-style: solid;
        padding: 8px;
        float: left;
        width: 100%;
    }
    
    .naoSelecionado {
        background-color: #fff;
    }
    .selecionado {
        background-color: #fee;
    }
</style>

<link href="@Url.Content("~/Scripts/google_prettifier/prettify.css")" rel="stylesheet" type="text/css" />

<h2>
    Sequencer</h2>
<fieldset>
    <legend>@Model.Nome</legend>
    <div id="container">
        <div id="divEscripte">
            <pre id="preXixizero" class="prettyprint" contenteditable="true"></pre>
        </div>
        <div id="divListaXixizeros">
            <ul id="listaXixizeros">
                <li>0 - original</li>
            </ul>
        </div>
        <div id="divResultadoParcial">
            <pre id="preResposta"></pre>
        </div>
    </div>
    <br />
    <div class="display-field ">
        @Html.DisplayFor(model => model.Descricao)
    </div>
    <div id="divPreEscripteCompleto">
        <pre id="preEscripteCompleto" class="prettyprint">@Model.Texto</pre>
    </div>
    <div>
        <input id="btnSalvar" type="button" value="Salvar" />
    </div>

</fieldset>
<p>
    @Html.ActionLink("Edit", "Edit", new { id = Model.IdSha1 }) |
    @Html.ActionLink("Back to List", "Index")
</p>
